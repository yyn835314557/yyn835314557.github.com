---
layout: post
title: "Swift内存管理(ARC-自动引用计数)"
date: 2015-07-06
comments: true
categories: iOS
tags: [Swift] 
keywords: 内存管理
description: Swift内存管理(ARC-自动引用计数)
---

本文主要介绍iOS中的Swift内存管理(ARC-自动引用计数)，注意其余Objective-C的比较。

ps:autorelease pool

###概念：

> 引用计数
   每个Swift类创建的对象都有一个内部计数器，这个计数器跟踪对象的引用次数，称为引用计数（Reference Count，简称RC）。当对象被创建的时候，引用计数为1，每次对象被引用的时候会使其引用计数加1，如果不需要的时候，对象引用断开（赋值为nil），其引用计数减1。当对象的引用计数为0的时候，对象的内存才被释放。
	eg：一个人进入房间打开灯，就是创建一个对象，这时候对象的引用计数是1。有人进入房间，引用计数加1；有人离开房间，引用计数减1。最后一个人离开房间，引用计数为0，房间灯关闭，对象内存才被释放

	- Swift使用自动引用计数（ARC）来管理应用程序的内存使用。这表示内存管理已经是Swift的一部分，在大多数情况下，你并不需要考虑内存的管理。当实例并不再被需要时，ARC会自动释放这些实例所使用的内存
	- 引用计数仅仅作用于类实例上。结构和枚举是值类型，而非引用类型，所以不能被引用存储和传递,值类型由处理器自动管理。
	- 每当创建一个类的实例，ARC分配一个内存块来存储这个实例的信息，包含了类型信息和实例的属性值信息。
	另外当实例不再被使用时，ARC会释放实例所占用的内存，这些内存可以再次被使用。
	但是，如果ARC释放了正在被使用的实例，就不能再访问实例属性，或者调用实例的方法了。直接访问这个实例可能造成应用程序的崩溃。就像空实例或游离实例一样。
	为了保证需要实例时实例是存在的，ARC对每个类实例，都追踪有多少属性、常量、变量指向这些实例。当有活动引用指向它时，ARC是不会释放这个实例的。
	- 当你将类实例赋值给属性、常量或变量时，指向实例的一个强引用（strongreference）将会被构造出来。被称为强引用是因为它稳定地持有这个实例，当这个强引用存在时，实例就不能够被自动释放，因此可以安全地使用。

###ARC的问题:
	- 循环强引用导致内存泄漏
		- 自始至终都没有调用deinit。因此就会泄漏，此时已经不能采取任何措拖来释放这两个对象了，只有等APP的生命周期结束实例之间的相互引用，在日常开发中是很常见的一种，哪么如何避免这种循环强引用导致的内存泄漏呢？可以通过在类之间定义为弱引用（weak）或无宿主引用的（unowned）变量可以解决强引用循环这个问题

***

下一篇:

[iOS多线程总结.md](https://yyn835314557.github.io/ios/2015-07-25-iOS多线程总结.html)